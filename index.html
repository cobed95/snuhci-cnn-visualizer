<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
  <title>d3.js grid of squares</title>
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style type="text/css">
  </style>
</head>
<body>
  <div display="flex" flex-direction="row">
    <div class="mdc-touch-target-wrapper">
      <button class="mdc-button mdc-button--touch">
        <div class="mdc-button__ripple"></div>
        <span class="mdc-button__label">Play</span>
        <div class="mdc-button__touch"></div>
      </button>
    </div>
    <div class="mdc-slider" tabindex="0" role="slider"
      aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
      aria-label="Select Value" width="500">
      <div class="mdc-slider__track-container">
        <div class="mdc-slider__track"></div>
      </div>
      <div class="mdc-slider__thumb-container">
        <svg class="mdc-slider__thumb" width="21" height="21">
          <circle cx="10.5" cy="10.5" r="7.875"></circle>
        </svg>
        <div class="mdc-slider__focus-ring"></div>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript">
const { ripple, slider } = mdc;
const { MDCSlider } = slider;
const epochSlider = new MDCSlider(document.querySelector('.mdc-slider'));
epochSlider.listen('MDCSlider:change', () => console.log(`Value changed to ${epochSlider.value}`));

const { MDCRipple } = ripple;
const playButton = document.querySelector('.mdc-button')
const playButtonRipple = new MDCRipple(playButton);
// playButtonRipple.listen('MDCRipple:onclick', () => console.log(`Value changed to ${playButtonRipple.value}`));

const getEpoch = () => epochSlider.value;

const width = 5000;
const height = 5000;

const cnn = {
  conv: [ 
    {
      weights: [
        [0.0, 0.4, 1.0],
        [0.35, 0.8, 0.3],
        [0.2, 0.68, 0.58]
      ]
    },
    {
      weights: [
        [0.3, 0.4, 1.0],
        [0.35, 0.8, 0.3],
        [0.2, 0.68, 0.58]
      ]
    },
    {
      weights: [
        [0.3, 0.8, 1.0],
        [1.0, 0.3, 0.3],
        [0.0, 0.77, 0.58]
      ]
    }
  ],
  subsampling: [
    {
      weights: [
        [0.0, 1.0],
        [0.3, 0.7]
      ]
    },
    {
      weights: [
        [0.25, 0.95],
        [0.3, 0.7]
      ]
    }
  ]
}

const svg = d3.select("body")
  .append("svg")
  .attr("width", width)
  .attr("height", height);

// Conv Layers
const conv = svg.selectAll(".rect")
  .data(cnn.conv)
  .enter()
  .append("g")
  .classed('rect', true);

conv
  .append("text")
  .text("Convolution Layers");

const colorScale = d3.scale.linear().domain([0.0, 1.0]).range(['white', 'black']);

cnn.conv.forEach((layer, idx) => {
  const layerAgg = conv.append("g")
    .attr("transform", d => "translate(" + (idx * 80.0) + "," + 0.0 + ")")
    .attr("stroke", "black");

  for (var row = 0; row < layer.weights.length; row++) {
    for (var col = 0; col < layer.weights[row].length; col++) {
      layerAgg.append("rect")
        .attr("width", 20)
        .attr("height", 20)
        .attr("x", row * 20)
        .attr("y", col * 20)
        .attr("fill", d => colorScale(layer.weights[row][col]));
    }
  }
});

const subsampling = svg.selectAll(".subsampling")
  .data(cnn.subsampling)
  .enter()
  .append("g");

cnn.subsampling.forEach((layer, idx) => {
  const layerAgg = subsampling.append("g")
    .attr("transform", d => "translate(" + (idx * 60.0) + "," + 0.0 + ")")
    .attr("stroke", "black");

  for (var row = 0; row < layer.weights.length; row++) {
    for (var col = 0; col < layer.weights[row].length; col++) {
      layerAgg.append("rect")
        .attr("width", 20)
        .attr("height", 20)
        .attr("x", row * 20)
        .attr("y", col * 20)
        .attr("fill", d => colorScale(layer.weights[row][col]));
    }
  }
});

subsampling
  .attr("transform", d => "translate(" + 0 + "," + 100 + ")");

</script>
</body>
